# Inline Image Generation

Расширение для SillyTavern. Ловит теги `[IMG:GEN:{...}]` в сообщениях ИИ и генерирует картинки через API.

## Формат тега

```
[IMG:GEN:{"style":"anime","prompt":"девушка с красными волосами"}]
```

### Параметры тега

| Параметр | Описание | Пример |
|----------|----------|--------|
| `style` | Стиль генерации (опционально) | `"anime"`, `"realistic"` |
| `prompt` | Описание картинки | `"девушка с красными волосами"` |
| `aspect_ratio` | Соотношение сторон (для nano-banana) | `"16:9"`, `"9:16"`, `"1:1"` |
| `image_size` | Разрешение/качество (для nano-banana) | `"1K"`, `"2K"`, `"4K"` |
| `quality` | Качество (для OpenAI) | `"standard"`, `"hd"` |

### Примеры тегов

Простой:
```
[IMG:GEN:{"prompt":"закат над морем"}]
```

С параметрами для nano-banana:
```
[IMG:GEN:{"style":"anime","prompt":"девушка с красными волосами","aspect_ratio":"9:16","image_size":"2K"}]
```

## Настройки

Открыть Extensions → Генерация картинок

- **Тип API**: OpenAI-совместимый или Gemini (nano-banana)
- **URL эндпоинта**: базовый URL API
- **API ключ**: ключ авторизации
- **Модель**: выбрать из списка (кнопка обновления подтягивает модели с `/v1/models`)
- **Размер**: 1024x1024, 1792x1024, 1024x1792, 512x512 (для OpenAI)
- **Качество**: standard / hd (для OpenAI)

### Для nano-banana

- **Соотношение сторон**: 1:1, 2:3, 3:2, 3:4, 4:3, 4:5, 5:4, 9:16, 16:9, 21:9
- **Разрешение**: 1K, 2K, 4K
- **Референсы**: отправлять аватарки {{char}} и {{user}} для консистентной генерации персонажей

## Поддерживаемые API

**OpenAI-совместимый** — `/v1/images/generations`
- DALL-E, Midjourney, Stable Diffusion, FLUX и прочие через прокси

**Gemini-совместимый** — `/v1beta/models/{model}:generateContent`
- nano-banana

## Как работает

1. ИИ пишет сообщение с тегом `[IMG:GEN:{...}]`
2. Расширение парсит тег, показывает спиннер
3. Отправляет запрос на API
4. Заменяет тег на сгенерированную картинку
5. Сохраняет картинку в файл и обновляет сообщение

При ошибке показывает кнопку "Повторить". Автоматические ретраи с экспоненциальной задержкой для 429/502/503/504.

## Файлы

```
manifest.json  — метаданные расширения
index.js       — логика
style.css      — стили
prompt.md      — промпт для ИИ
```
